AWSTemplateFormatVersion: 2010-09-09
Description: >-
  The parameters used by the Alcolizer-Rekognition Serverless Application
Parameters:
  HierarchyKey:
    Type: String
    Default: dev
    Description: This is the environment that will determine the SSMParamaters - /test/production
    MinLength: '1'
    ConstraintDescription: This parameter is required.   
Resources:
  ApplicationRegionParameter:
    Type: AWS::SSM::Parameter
    Properties: 
      Name: !Join ['', ['/alcolizer-rekognition/', !Ref HierarchyKey, '/dynamoDB/region']] 
      DataType: text
      Description: The region for the Rekognition Collection and DynamboDB tables.                
      Tier: Standard
      Type: String
      Value: ap-southeast-2
  ApplicationAlcolizerResultsDBTableParameter:
    Type: AWS::SSM::Parameter
    Properties: 
      Name: !Join ['', ['/alcolizer-rekognition/', !Ref HierarchyKey, '/dynamoDB/breathalyzer-result-table']] 
      DataType: text
      Description: The DynamoDB table for storeing the Alcolizer Readings.
      Tier: Standard
      Type: String
      Value: !Join ['', ['alcolizer-', !Ref HierarchyKey, '-breathalyzer-results']] 
  ApplicationRekognitionResultsDBTableParameter:
    Type: AWS::SSM::Parameter
    Properties: 
      Name: !Join ['', ['/alcolizer-rekognition/', !Ref HierarchyKey, '/dynamoDB/rekognition-result']]
      DataType: text
      Description: The DynamoDB table for storeing the Rekognition results.
      Tier: Standard
      Type: String
      Value: !Join ['', ['alcolizer-', !Ref HierarchyKey, '-rekognition-results']]
  ApplicationAlcolizerLocationDBTableParameter:
    Type: AWS::SSM::Parameter
    Properties: 
      Name: !Join ['', ['/alcolizer-rekognition/', !Ref HierarchyKey, '/dynamoDB/location']]
      DataType: text
      Description: The DynamoDB table for storeing the Alcolizer Location map
      Tier: Standard
      Type: String
      Value: !Join ['', ['alcolizer-', !Ref HierarchyKey, '-alcolizer-location-map']]
  ApplicationAlcolizerLocationDefaultParameter:
    Type: AWS::SSM::Parameter
    Properties: 
      Name: !Join ['', ['/alcolizer-rekognition/', !Ref HierarchyKey, '/location/default']]
      DataType: text
      Description: The default location value used for an unmapped serial No.
      Tier: Standard
      Type: String
      Value: (Unknown):Unregistered
  ApplicationS3BucketParameter:
    Type: AWS::SSM::Parameter
    Properties: 
      Name: !Join ['', ['/alcolizer-rekognition/', !Ref HierarchyKey, '/s3/bucket']]
      DataType: text
      Description: The s3 bucket for the Alcolizer - Rekognition app.
      Tier: Standard
      Type: String
      Value: !Join ['', [!Ref HierarchyKey, '-alcolizer-rekognition']]
  ApplicationS3FacesKeyParameter:
    Type: AWS::SSM::Parameter
    Properties: 
      Name: !Join ['', ['/alcolizer-rekognition/', !Ref HierarchyKey, '/s3/facesKey']]
      DataType: text
      Description: The folder for the faces extracted from the email.
      Tier: Standard
      Type: String
      Value: faces/
  ApplicationStepFunctionParameter:
    Type: AWS::SSM::Parameter
    Properties: 
      Name: !Join ['', ['/alcolizer-rekognition/', !Ref HierarchyKey, '/step-function']]
      DataType: text
      Description: The ARN for the Step Function that orhestrates parsing the email.
      Tier: Standard
      Type: String
      Value: !Join ['', ['arn:aws:states:ap-southeast-2:317510107845:stateMachine:Alcolizer-Rekognizer-Email-Statemachine-', !Ref HierarchyKey]]
  ApplicationRekognitionCollectionIdParameter:
    Type: AWS::SSM::Parameter
    Properties: 
      Name: !Join ['', ['/alcolizer-rekognition/', !Ref HierarchyKey, '/rekognition/collection-id']]
      DataType: text
      Description: The id of the Rekognition face collection.
      Tier: Standard
      Type: String
      Value: uat-rekognition-collection
  ApplicationRekognitionCollectionThresholdParameter:
    Type: AWS::SSM::Parameter
    Properties: 
      Name: !Join ['', ['/alcolizer-rekognition/', !Ref HierarchyKey, '/rekognition/threshold']]
      DataType: text
      Description: The similalrity threshold for which matched faces are returned.
      Tier: Standard
      Type: String
      Value: 90
  ApplicationRekognitionCollectionMaxFacesParameter:
    Type: AWS::SSM::Parameter
    Properties: 
      Name: !Join ['', ['/alcolizer-rekognition/', !Ref HierarchyKey, '/rekognition/maxfaces']]
      DataType: text
      Description: The maximum number of faces returned by the search_faces_by_image rekognition API .
      Tier: Standard
      Type: String
      Value: 5
  ApplicationS3OutputKeyParameter:
    Type: AWS::SSM::Parameter
    Properties: 
      Name: !Join ['', ['/alcolizer-rekognition/', !Ref HierarchyKey, '/s3/outputKey']]
      DataType: text
      Description: The S3 folder for storing the step function output .
      Tier: Standard
      Type: String
      Value: output/
  ApplicationS3AttachmentKeyParameter:
    Type: AWS::SSM::Parameter
    Properties: 
      Name: !Join ['', ['/alcolizer-rekognition/', !Ref HierarchyKey, '/s3/attachmentKey']]
      DataType: text
      Description: The region for the Rekognition Collection and DynamboDB tables.                
      Tier: Standard
      Type: String
      Value: attachments/
  ApplicationS3StatusLogKeyParameter:
    Type: AWS::SSM::Parameter
    Properties: 
      Name: !Join ['', ['/alcolizer-rekognition/', !Ref HierarchyKey, '/s3/statusLogKey']]
      DataType: text
      Description: The region for the Rekognition Collection and DynamboDB tables.                
      Tier: Standard
      Type: String
      Value: status/
  GallagherAuthorizationKeyParameter:
    Type: AWS::SSM::Parameter
    Properties: 
      Name: !Join ['', ['/alcolizer-rekognition/', !Ref HierarchyKey, '/gallagher/authorizationKey']]
      DataType: text
      Description: The region for the Rekognition Collection and DynamboDB tables.                
      Tier: Standard
      Type: String
      Value: GGL-API-KEY 17D5-F104-F506-1D37-72AC-B5E6-ACFC-87A2  
  GallagherAPIUrlParameter:
    Type: AWS::SSM::Parameter
    Properties: 
      Name: !Join ['', ['/alcolizer-rekognition/', !Ref HierarchyKey, '/gallagher/API-url']]
      DataType: text
      Description: The region for the Rekognition Collection and DynamboDB tables.                
      Tier: Standard
      Type: String
      Value: https://uatgal01.fmguat.local:8904  
  PositiveNotificationHTMLTemplateParameter:
    Type: AWS::SSM::Parameter
    Properties: 
      Name: !Join ['', ['/alcolizer-rekognition/', !Ref HierarchyKey, '/s3/email/breathresult-html-template']]
      DataType: text
      Description: The HTML template for a positive results notification.                
      Tier: Standard
      Type: String
      Value: config/positive-result-notification-template.html
  StatusNotificationHTMLTemplateParameter:
    Type: AWS::SSM::Parameter
    Properties: 
      Name: !Join ['', ['/alcolizer-rekognition/', !Ref HierarchyKey, '/s3/email/status-html-template']]
      DataType: text
      Description: The HTML template for a positive results notification.                
      Tier: Standard
      Type: String
      Value: config/status-notification-template.html
  SMSNotificationTemplateParameter:
    Type: AWS::SSM::Parameter
    Properties: 
      Name: !Join ['', ['/alcolizer-rekognition/', !Ref HierarchyKey, '/s3/sms/text-msg-template']]
      DataType: text
      Description: The HTML template for a positive results notification.                
      Tier: Standard
      Type: String
      Value: config/positive-sms-template.txt
  SMSNotificationTopicARN:
    Type: AWS::SSM::Parameter
    Properties: 
      Name: !Join ['', ['/alcolizer-rekognition/', !Ref HierarchyKey, '/sns/topic/notification']]
      DataType: text
      Description: The HTML template for a positive results notification.                
      Tier: Standard
      Type: String
      Value: arn:aws:sns:ap-southeast-2:317510107845:Alcolizer-Rekognition-Notification
  ServerSMTPParameter:
    Type: AWS::SSM::Parameter
    Properties: 
      Name: !Join ['', ['/alcolizer-rekognition/', !Ref HierarchyKey, '/email/smtp-server']]
      DataType: text
      Description: The target SMTP Server for mail relay 
      Tier: Standard
      Type: String
      Value: mailrelay.fmg.local
  NotificationRuleConfigParameter:
    Type: AWS::SSM::Parameter
    Properties: 
      Name: !Join ['', ['/alcolizer-rekognition/', !Ref HierarchyKey, '/notifications/config']]
      DataType: text
      Description: The json configure used by the notification rules - updated separately
      Tier: Standard
      Type: String
      Value: "{}"
  